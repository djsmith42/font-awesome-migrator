#!/usr/bin/env python
import sys, re

"""
Given a list of files on the command line, this script attempts to intelligently
migrate the file from FontAwesome 3 to FontAwesome 4.
"""

HTML_FILE_REGEX = re.compile(r'\.htm?l?$',     flags=re.IGNORECASE)
CSS_FILE_REGEX  = re.compile(r'\.(css|less)$', flags=re.IGNORECASE)

def main():
    replacements = _build_replacements_dictionary()

    for i in range(1, len(sys.argv)):
        file_path = sys.argv[i]
        print "Upgrading file {0}".format(file_path)

        is_html = bool(HTML_FILE_REGEX.search(file_path))
        is_css  = bool(CSS_FILE_REGEX.search(file_path))

        file_contents = _read_file(file_path)

        for old, new in replacements.items():
            if is_html:
                new = 'fa {0}'.format(new)
            if is_css:
                old = '.{0}'.format(old)
                new = '.{0}'.format(new)
            file_contents = file_contents.replace(old, new)

        _write_file(file_path, file_contents)

def _build_replacements_dictionary():
    ret = {}
    for old_icon_name in all_old_icon_names:
        new = old_icon_name_to_new_icon_name.get(old_icon_name)
        if new is not None:
            new = 'fa-{0}'.format(new)
        else:
            new = 'fa-{0}'.format(old_icon_name)
        old = 'icon-{0}'.format(old_icon_name)
        ret[old] = new
    return ret

def _read_file(file_path):
    try:
        with open(file_path) as f:
            return f.read()
    except IOError as err:
        print "Could not read file {0}: {1}".format(file_path, err)
        sys.exit(1)

def _write_file(file_path, file_contents):
    try:
        with open(file_path, 'w') as f:
            f.write(file_contents)
    except IOError as err:
        print "Could not write file {0}: {1}".format(file_path, err)
        sys.exit(1)

old_icon_name_to_new_icon_name = {
    'ban-circle' : 'ban',
    'bar-chart' : 'bar-chart-o',
    'beaker' : 'flask',
    'bell-alt' : 'bell',
    'bell' : 'bell-o',
    'bitbucket-sign' : 'bitbucket-square',
    'bookmark-empty' : 'bookmark-o',
    'building' : 'building-o',
    'calendar-empty' : 'calendar-o',
    'check-empty' : 'square-o',
    'check-minus' : 'minus-square-o',
    'check-sign' : 'check-square',
    'check' : 'check-square-o',
    'chevron-sign-down' : 'chevron-circle-down',
    'chevron-sign-left' : 'chevron-circle-left',
    'chevron-sign-right' : 'chevron-circle-right',
    'chevron-sign-up' : 'chevron-circle-up',
    'circle-arrow-down' : 'arrow-circle-down',
    'circle-arrow-left' : 'arrow-circle-left',
    'circle-arrow-right' : 'arrow-circle-right',
    'circle-arrow-up' : 'arrow-circle-up',
    'circle-blank' : 'circle-o',
    'cny' : 'rub',
    'collapse-alt' : 'collapse-o',
    'collapse-top' : 'caret-square-o-up',
    'collapse' : 'caret-square-o-down',
    'comment-alt' : 'comment-o',
    'comments-alt' : 'comments-o',
    'copy' : 'files-o',
    'cut' : 'scissors',
    'dashboard' : 'tachometer',
    'double-angle-down' : 'angle-double-down',
    'double-angle-left' : 'angle-double-left',
    'double-angle-right' : 'angle-double-right',
    'double-angle-up' : 'angle-double-up',
    'download-alt' : 'download',
    'download' : 'arrow-circle-o-down',
    'edit-sign' : 'pencil-square',
    'edit' : 'pencil-square-o',
    'ellipsis-horizontal' : 'ellipsis-h',
    'ellipsis-vertical' : 'ellipsis-v',
    'envelope-alt' : 'envelope-o',
    'exclamation-sign' : 'exclamation-circle',
    'expand-alt' : 'expand-o',
    'expand' : 'caret-square-o-right',
    'external-link-sign' : 'external-link-square',
    'eye-close' : 'eye-slash',
    'eye-open' : 'eye',
    'facebook-sign' : 'facebook-square',
    'facetime-video' : 'video-camera',
    'file-alt' : 'file-o',
    'file-text-alt' : 'file-text-o',
    'flag-alt' : 'flag-o',
    'folder-close-alt' : 'folder-o',
    'folder-close' : 'folder',
    'folder-open-alt' : 'folder-open-o',
    'food' : 'cutlery',
    'frown' : 'frown-o',
    'fullscreen' : 'arrows-alt',
    'github-sign' : 'github-square',
    'google-plus-sign' : 'google-plus-square',
    'group' : 'users',
    'h-sign' : 'h-square',
    'hand-down' : 'hand-o-down',
    'hand-left' : 'hand-o-left',
    'hand-right' : 'hand-o-right',
    'hand-up' : 'hand-o-up',
    'hdd' : 'hdd-o (4.0.1)',
    'heart-empty' : 'heart-o',
    'hospital' : 'hospital-o',
    'indent-left' : 'outdent',
    'indent-right' : 'indent',
    'info-sign' : 'info-circle',
    'keyboard' : 'keyboard-o',
    'legal' : 'gavel',
    'lemon' : 'lemon-o',
    'lightbulb' : 'lightbulb-o',
    'linkedin-sign' : 'linkedin-square',
    'meh' : 'meh-o',
    'microphone-off' : 'microphone-slash',
    'minus-sign-alt' : 'minus-square',
    'minus-sign' : 'minus-circle',
    'mobile-phone' : 'mobile',
    'moon' : 'moon-o',
    'move' : 'arrows',
    'off' : 'power-off',
    'ok-circle' : 'check-circle-o',
    'ok-sign' : 'check-circle',
    'ok' : 'check',
    'paper-clip' : 'paperclip',
    'paste' : 'clipboard',
    'phone-sign' : 'phone-square',
    'picture' : 'picture-o',
    'pinterest-sign' : 'pinterest-square',
    'play-circle' : 'play-circle-o',
    'play-sign' : 'play-circle',
    'plus-sign-alt' : 'plus-square',
    'plus-sign' : 'plus-circle',
    'pushpin' : 'thumb-tack',
    'question-sign' : 'question-circle',
    'remove-circle' : 'times-circle-o',
    'remove-sign' : 'times-circle',
    'remove' : 'times',
    'reorder' : 'bars',
    'resize-full' : 'expand',
    'resize-horizontal' : 'arrows-h',
    'resize-small' : 'compress',
    'resize-vertical' : 'arrows-v',
    'rss-sign' : 'rss-square',
    'save' : 'floppy-o',
    'screenshot' : 'crosshairs',
    'share-alt' : 'share',
    'share-sign' : 'share-square',
    'share' : 'share-square-o',
    'sign-blank' : 'square',
    'signin' : 'sign-in',
    'signout' : 'sign-out',
    'smile' : 'smile-o',
    'sort-by-alphabet-alt' : 'sort-alpha-desc',
    'sort-by-alphabet' : 'sort-alpha-asc',
    'sort-by-attributes-alt' : 'sort-amount-desc',
    'sort-by-attributes' : 'sort-amount-asc',
    'sort-by-order-alt' : 'sort-numeric-desc',
    'sort-by-order' : 'sort-numeric-asc',
    'sort-down' : 'sort-asc',
    'sort-up' : 'sort-desc',
    'stackexchange' : 'stack-overflow',
    'star-empty' : 'star-o',
    'star-half-empty' : 'star-half-o',
    'sun' : 'sun-o',
    'thumbs-down-alt' : 'thumbs-o-down',
    'thumbs-up-alt' : 'thumbs-o-up',
    'time' : 'clock-o',
    'trash' : 'trash-o',
    'tumblr-sign' : 'tumblr-square',
    'twitter-sign' : 'twitter-square',
    'unlink' : 'chain-broken',
    'upload-alt' : 'upload',
    'upload' : 'arrow-circle-o-up',
    'warning-sign' : 'exclamation-triangle',
    'xing-sign' : 'xing-square',
    'youtube-sign' : 'youtube-square',
    'zoom-in' : 'search-plus',
    'zoom-out' : 'search-minus',
}

all_old_icon_names = [
    'glass',
    'music',
    'search',
    'envelope-alt',
    'heart',
    'star',
    'star-empty',
    'user',
    'film',
    'th-large',
    'th',
    'th-list',
    'ok',
    'remove',
    'zoom-in',
    'zoom-out',
    'off',
    'signal',
    'cog',
    'trash',
    'home',
    'file-alt',
    'time',
    'road',
    'download-alt',
    'download',
    'upload',
    'inbox',
    'play-circle',
    'repeat',
    'refresh',
    'list-alt',
    'lock',
    'flag',
    'headphones',
    'volume-off',
    'volume-down',
    'volume-up',
    'qrcode',
    'barcode',
    'tag',
    'tags',
    'book',
    'bookmark',
    'print',
    'camera',
    'font',
    'bold',
    'italic',
    'text-height',
    'text-width',
    'align-left',
    'align-center',
    'align-right',
    'align-justify',
    'list',
    'indent-left',
    'indent-right',
    'facetime-video',
    'picture',
    'pencil',
    'map-marker',
    'adjust',
    'tint',
    'edit',
    'share',
    'check',
    'move',
    'step-backward',
    'fast-backward',
    'backward',
    'play',
    'pause',
    'stop',
    'forward',
    'fast-forward',
    'step-forward',
    'eject',
    'chevron-left',
    'chevron-right',
    'plus-sign',
    'minus-sign',
    'remove-sign',
    'ok-sign',
    'question-sign',
    'info-sign',
    'screenshot',
    'remove-circle',
    'ok-circle',
    'ban-circle',
    'arrow-left',
    'arrow-right',
    'arrow-up',
    'arrow-down',
    'share-alt',
    'resize-full',
    'resize-small',
    'plus',
    'minus',
    'asterisk',
    'exclamation-sign',
    'gift',
    'leaf',
    'fire',
    'eye-open',
    'eye-close',
    'warning-sign',
    'plane',
    'calendar',
    'random',
    'comment',
    'magnet',
    'chevron-up',
    'chevron-down',
    'retweet',
    'shopping-cart',
    'folder-close',
    'folder-open',
    'resize-vertical',
    'resize-horizontal',
    'bar-chart',
    'twitter-sign',
    'facebook-sign',
    'camera-retro',
    'key',
    'cogs',
    'comments',
    'thumbs-up-alt',
    'thumbs-down-alt',
    'star-half',
    'heart-empty',
    'signout',
    'linkedin-sign',
    'pushpin',
    'external-link',
    'signin',
    'trophy',
    'github-sign',
    'upload-alt',
    'lemon',
    'phone',
    'check-empty',
    'bookmark-empty',
    'phone-sign',
    'twitter',
    'facebook',
    'github',
    'unlock',
    'credit-card',
    'rss',
    'hdd',
    'bullhorn',
    'bell',
    'certificate',
    'hand-right',
    'hand-left',
    'hand-up',
    'hand-down',
    'circle-arrow-left',
    'circle-arrow-right',
    'circle-arrow-up',
    'circle-arrow-down',
    'globe',
    'wrench',
    'tasks',
    'filter',
    'briefcase',
    'fullscreen',
    'group',
    'link',
    'cloud',
    'beaker',
    'cut',
    'copy',
    'paper-clip',
    'save',
    'sign-blank',
    'reorder',
    'list-ul',
    'list-ol',
    'strikethrough',
    'underline',
    'table',
    'magic',
    'truck',
    'pinterest',
    'pinterest-sign',
    'google-plus-sign',
    'google-plus',
    'money',
    'caret-down',
    'caret-up',
    'caret-left',
    'caret-right',
    'columns',
    'sort',
    'sort-down',
    'sort-up',
    'envelope',
    'linkedin',
    'undo',
    'legal',
    'dashboard',
    'comment-alt',
    'comments-alt',
    'bolt',
    'sitemap',
    'umbrella',
    'paste',
    'lightbulb',
    'exchange',
    'cloud-download',
    'cloud-upload',
    'user-md',
    'stethoscope',
    'suitcase',
    'bell-alt',
    'coffee',
    'food',
    'file-text-alt',
    'building',
    'hospital',
    'ambulance',
    'medkit',
    'fighter-jet',
    'beer',
    'h-sign',
    'plus-sign-alt',
    'double-angle-left',
    'double-angle-right',
    'double-angle-up',
    'double-angle-down',
    'angle-left',
    'angle-right',
    'angle-up',
    'angle-down',
    'desktop',
    'laptop',
    'tablet',
    'mobile-phone',
    'circle-blank',
    'quote-left',
    'quote-right',
    'spinner',
    'circle',
    'reply',
    'github-alt',
    'folder-close-alt',
    'folder-open-alt',
    'expand-alt',
    'collapse-alt',
    'smile',
    'frown',
    'meh',
    'gamepad',
    'keyboard',
    'flag-alt',
    'flag-checkered',
    'terminal',
    'code',
    'reply-all',
    'mail-reply-all',
    'star-half-empty',
    'location-arrow',
    'crop',
    'code-fork',
    'unlink',
    'question',
    'info',
    'exclamation',
    'superscript',
    'subscript',
    'eraser',
    'puzzle-piece',
    'microphone',
    'microphone-off',
    'shield',
    'calendar-empty',
    'fire-extinguisher',
    'rocket',
    'maxcdn',
    'chevron-sign-left',
    'chevron-sign-right',
    'chevron-sign-up',
    'chevron-sign-down',
    'html5',
    'css3',
    'anchor',
    'unlock-alt',
    'bullseye',
    'ellipsis-horizontal',
    'ellipsis-vertical',
    'rss-sign',
    'play-sign',
    'ticket',
    'minus-sign-alt',
    'check-minus',
    'level-up',
    'level-down',
    'check-sign',
    'edit-sign',
    'external-link-sign',
    'share-sign',
    'compass',
    'collapse',
    'collapse-top',
    'expand',
    'eur',
    'gbp',
    'usd',
    'inr',
    'jpy',
    'cny',
    'krw',
    'btc',
    'file',
    'file-text',
    'sort-by-alphabet',
    'sort-by-alphabet-alt',
    'sort-by-attributes',
    'sort-by-attributes-alt',
    'sort-by-order',
    'sort-by-order-alt',
    'thumbs-up',
    'thumbs-down',
    'youtube-sign',
    'youtube',
    'xing',
    'xing-sign',
    'youtube-play',
    'dropbox',
    'stackexchange',
    'instagram',
    'flickr',
    'adn',
    'bitbucket',
    'bitbucket-sign',
    'tumblr',
    'tumblr-sign',
    'long-arrow-down',
    'long-arrow-up',
    'long-arrow-left',
    'long-arrow-right',
    'apple',
    'windows',
    'android',
    'linux',
    'dribbble',
    'skype',
    'foursquare',
    'trello',
    'female',
    'male',
    'gittip',
    'sun',
    'moon',
    'archive',
    'bug',
    'vk',
    'weibo',
    'renren',
]

if __name__ == '__main__':
    main()
